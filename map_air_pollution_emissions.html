<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map_Air Pollution Emissions</title>
    <style type="text/css">
      .highcharts-figure .highcharts-data-table table {
        min-width: 360px;
        max-width: 800px;
        margin: 1em auto;
      }

      .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
      }

      .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
      }

      .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
      }

      .highcharts-data-table td,
      .highcharts-data-table th,
      .highcharts-data-table caption {
        padding: 0.5em;
      }

      .highcharts-data-table thead tr,
      .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
      }

      .highcharts-data-table tr:hover {
        background: #f1f7ff;
      }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.6/proj4.js"></script>
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/data.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/accessibility.js"></script>
    <div class="box">
      <div
        data-highcharts-chart="1"
        style="height: 828px; width: 100%; overflow: hidden"
        id="container"
      ></div>
      <div id="slider-container">
        <input
          type="range"
          min="1999"
          max="2000"
          value="2000"
          id="year-slider"
        />
        <p>Year: <span id="selected-year">2000</span></p>
      </div>
    </div>
    <!-- <figure class="highcharts-figure">
      <div id="container"></div>
      <p class="highcharts-description">
        Chart showing data loaded dynamically. The individual data points can be
        clicked to display more information.
      </p>
    </figure> -->

    <script type="text/javascript">
      (async () => {
        const topology = await fetch(
          //"https://code.highcharts.com/mapdata/countries/us/us-all.topo.json"
          "https://code.highcharts.com/mapdata/countries/kr/kr-all.topo.json"
        ).then((response) => response.json());

        // const data = await fetch(
        //   "https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/us-capitals.json"
        // ).then((response) => response.json());

        // data and map.
        // const data = [
        //   ["kr-4194", 10],
        //   ["kr-kg", 11],
        //   ["kr-cb", 12],
        //   ["kr-kn", 13],
        //   ["kr-2685", 14],
        //   ["kr-pu", 15],
        //   ["kr-2688", 16],
        //   ["kr-sj", 17],
        //   ["kr-tj", 18],
        //   ["kr-ul", 19],
        //   ["kr-in", 20],
        //   ["kr-kw", 21],
        //   ["kr-gn", 22],
        //   ["kr-cj", 23],
        //   ["kr-gb", 24],
        //   ["kr-so", 25],
        //   ["kr-tg", 26],
        //   ["kr-kj", 27],
        // ];

        const data = await fetch(
          "https://raw.githubusercontent.com/researcher-jh/kei-high-chart/main/data/air_pollution_emissions_data.json"
        )
          .then((response) => response.json())
          .then((response) => response.data);

        let selectedYear = 1999;
        document
          .getElementById("year-slider")
          .addEventListener("input", function (e) {
            selectedYear = e.target.value;
            console.log(selectedYear);
          });
        data[0].data.forEach((p) => {
          p.z = p.population;
        });

        const H = Highcharts;

        const chart = Highcharts.mapChart("container", {
          title: {
            text: "Highcharts Maps lon/lat demo",
          },

          tooltip: {
            pointFormat:
              "{point.name}, {point.country}<br>" +
              // "Lon: {point.lon}<br>" +
              // "Lat: {point.lat}<br>" +
              "Population: {point.population}",
          },

          xAxis: {
            crosshair: {
              zIndex: 5,
              dashStyle: "dot",
              snap: false,
              color: "gray",
            },
          },

          yAxis: {
            crosshair: {
              zIndex: 5,
              dashStyle: "dot",
              snap: false,
              color: "gray",
            },
          },

          series: [
            {
              name: "South Korea Air Pollution emissions",
              mapData: topology,
              // accessibility: {
              //   exposeAsGroupOnly: true,
              // },
              borderColor: "#606060",
              nullColor: "rgba(200, 200, 200, 0.2)",
              showInLegend: false,
            },
            {
              name: "Air Pollation Emissions",
              type: "mappoint", //"mapbubble",
              dataLabels: {
                enabled: true,
                format: "{point.name}",
              },
              accessibility: {
                point: {
                  valueDescriptionFormat:
                    "{point.name}, Population {point.population}. Latitude {point.lat:.2f}, longitude {point.lon:.2f}.",
                },
              },
              data: data[0].data,
              maxSize: "12%",
              color: H.getOptions().colors[0],
            },
          ],
        });

        //Display custom label with lat/lon next to crosshairs
        document
          .getElementById("container")
          .addEventListener("mousemove", (e) => {
            if (!chart.lbl) {
              chart.lbl = chart.renderer
                .text("", 0, 0)
                .attr({
                  zIndex: 5,
                })
                .css({
                  color: "#505050",
                })
                .add();
            }

            e = chart.pointer.normalize(e);

            chart.lbl.attr({
              x: e.chartX + 5,
              y: e.chartY - 22,
              text: "Lat: " + e.lat.toFixed(2) + "<br>Lon: " + e.lon.toFixed(2),
            });
          });
      })();
    </script>
  </body>
</html>
